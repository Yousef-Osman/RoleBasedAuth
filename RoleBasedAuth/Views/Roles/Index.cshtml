@model IEnumerable<IdentityRole>;

@{
    ViewData["Title"] = "Index";
    var roleModel = new RoleVM();
}

<section class="col-md-6 mx-auto">
    <div class="card shadow p-5 mt-5">
        <div class="d-flex mb-3">
            <h4 class="me-auto text-dimgrey">User Roles</h4>
            <a class="btn btn-primary align-self-start" data-bs-toggle="modal" data-bs-target="#addRoleModal"><i class="fa-solid fa-plus"></i></a>
            @*<a class="btn btn-primary align-self-start" asp-action="AddRole"><i class="fa-solid fa-plus"></i></a>*@
        </div>
        <ul class="list-group">
            @foreach (var role in Model)
            {
                <li class="list-group-item">
                    <div class="d-flex justify-content-between align-content-center my-1">
                        <p class="mb-0 align-self-center">@role.Name</p>
                        <a asp-action="EditRole" asp-route-id="@role.Id" class="btn btn-warning"><i class="fas fa-edit text-white"></i></a>
                    </div>
                </li>
            }
        </ul>
        <a asp-controller="Admin" asp-action="Index" class="btn btn-outline-secondary mt-3 px-3 ms-auto">Back</a>
    </div>
</section>

<div class="modal fade" id="addRoleModal" tabindex="-1" aria-labelledby="addRoleModal" aria-hidden="true">
    @*<partial name="_addrolepartial" model="new IdentityRole()" />*@
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body px-5 py-4">
                <h4 class="my-3 text-success">Add new role</h4>
                <form method="post" id="add-form">
                    <div class="mb-3">
                        <label class="form-label" asp-for="@roleModel.Name"></label>
                        <input class="form-control" asp-for="@roleModel.Name" id="role-name" />
                        <span class="text-danger" asp-validation-for="@roleModel.Name"></span>
                    </div>
                    <div class="d-flex justify-content-end mb-3">
                        <button type="submit" class="btn btn-success px-3 me-1">Save</button>
                        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener("DOMContentLoaded", function (event) {
            document.getElementById('add-form').onsubmit = function (e) {

                if (!$(this).valid()) {
                    return;
                } 

                e.preventDefault();
                var form = new FormData();
                form.append("Name", document.getElementById('role-name').value);

                fetch('/Roles/AddRole', {
                    method: 'Post',
                    credentials: 'include',
                    body: form,
                }).then(response => {
                    if (!response.ok) {
                        throw new Error(response.status);
                    }

                    return response.json();
                }).then(data => {
                    console.log('success');
                }).catch(error => {
                    console.log('error');
                });
            }
        });
    </script>
}